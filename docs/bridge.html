<!DOCTYPE html>
<html>
<head>
  <title>IFTalk Storage Bridge</title>
</head>
<body>
<script>
/**
 * Storage Bridge for Cross-Origin Sync
 *
 * This page is loaded in a hidden iframe by dev servers to access
 * GitHub Pages localStorage. Responds to any non-production origin
 * (localhost, Tailscale, LAN IPs, etc.)
 */
const PRODUCTION_ORIGIN = 'https://baheard.github.io';

window.addEventListener('message', (e) => {
  // Security: only respond to dev origins (not production requesting itself)
  if (e.origin === PRODUCTION_ORIGIN) {
    console.warn('[Bridge] Rejected request from production');
    return;
  }

  if (e.data.type === 'getSaves') {
    const saves = {};
    for (let i = 0; i < localStorage.length; i++) {
      const key = localStorage.key(i);
      // Include game saves and settings
      if (key.startsWith('iftalk_') || key.startsWith('gameSettings_')) {
        saves[key] = localStorage.getItem(key);
      }
    }
    e.source.postMessage({ type: 'saves', data: saves }, e.origin);
  }
});

// Signal ready
console.log('[Bridge] Ready');
</script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>IF Talk - Voice-Powered Interactive Fiction</title>
  <link rel="icon" type="image/png" href="favicon.png">

  <!-- Local fonts for offline PWA support -->
  <link rel="stylesheet" href="/styles/fonts.css">

  <!-- PWA Manifest -->
  <link rel="manifest" href="/manifest.json">

  <!-- Theme colors for mobile browsers -->
  <meta name="theme-color" content="#2d5f8d">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Voxi">

  <!-- iOS icons -->
  <link rel="apple-touch-icon" href="/icons/icon-192.png">

  <!-- Glk API and Dialog (required by ZVM) -->
  <script src="lib/dialog-stub.js"></script>
  <script src="lib/glkapi.js"></script>

  <!-- ifvms ZVM interpreter -->
  <script src="lib/zvm.js"></script>

  <!-- Google Identity Services (OAuth 2.0) -->
  <script src="https://accounts.google.com/gsi/client" async defer></script>

  <link rel="stylesheet" href="styles/main.css">

  <meta name="viewport" content="width=device-width, initial-scale=1, interactive-widget=resizes-content">

</head>
<body>

  <!-- Loading Overlay -->
  <div class="loading-overlay" id="loadingOverlay"></div>

  <!-- Settings Panel -->
  <div class="settings-panel" id="settingsPanel">
    <div class="settings-header">
      <h2>Voxi - Settings</h2>
      <button id="closeSettingsBtn" class="close-settings-btn">‚úï</button>
    </div>

    <div class="settings-content">

      <!-- Quick Actions Section (default open) -->
      <div class="settings-section collapsible" id="quickActionsSection">
        <h3 class="section-header">
          <span class="material-icons">bolt</span> Quick Actions
        </h3>
        <div class="section-content">
          <!-- Home / Currently Playing (in-game only) -->
          <div class="current-game-display game-section-item" id="currentGameDisplay">
            <span class="current-game-info">
              <span class="current-game-label">Currently playing:</span>
              <span class="current-game-name" id="currentGameName">No game loaded</span>
            </span>
            <button class="btn btn-sm btn-secondary" id="selectGameBtn">
              <span class="material-icons">arrow_back</span> Home
            </button>
          </div>

          <!-- Keep Screen Awake toggle (mobile-only) -->
          <div class="setting-item mobile-only">
            <label>
              Keep Screen Awake
              <input type="checkbox" id="keepAwakeToggle" class="toggle-switch">
            </label>
            <p class="setting-description">Prevent device from going to sleep</p>
          </div>

          <!-- Lock Screen Now button (mobile-only) -->
          <button id="lockScreenBtn" class="compact-btn quick-action-btn">
            <span class="material-icons">screen_lock_portrait</span>
            Lock Screen Now
          </button>

          <!-- Quick Save/Load buttons (in-game only) -->
          <div class="game-section-item">
            <div class="button-group">
              <button id="quickSaveBtn" class="compact-btn quick-action-btn" title="F5">
                <span class="material-icons">save</span> Quick Save
              </button>
              <button id="quickRestoreBtn" class="compact-btn quick-action-btn" title="F9">
                <span class="material-icons">restore</span> Quick Restore
              </button>
            </div>

            <!-- Get ChatGPT Hint button (in-game only) -->
            <button id="getHintBtn" class="compact-btn quick-action-btn game-section-item" style="margin-top: 10px;">
              <span class="material-icons">lightbulb</span> Get ChatGPT Hint
            </button>
          </div>
        </div>
      </div>

      <!-- Audio Section -->
      <div class="settings-section collapsible collapsed" id="audioSection">
        <h3 class="section-header">
          <span class="material-icons">volume_up</span> Audio
        </h3>
        <div class="section-content">
          <!-- Master Volume -->
          <div class="setting-item">
            <label>Master Volume</label>
            <div class="slider-container">
              <input type="range" id="masterVolume" min="0" max="100" step="5" value="100" class="slider">
              <span id="masterVolumeValue" class="slider-value">100%</span>
            </div>
          </div>

          <!-- Sound Effects (moved from bottom) -->
          <div class="setting-item">
            <label>
              Sound Effects
              <input type="checkbox" id="soundEffectsToggle" class="toggle-switch" checked>
            </label>
            <p class="setting-description">Audio feedback for commands and actions</p>
          </div>

          <!-- Speech Speed -->
          <div class="setting-item">
            <label>Speech Speed</label>
            <div class="slider-container">
              <span class="slider-label">0.5x</span>
              <input type="range" id="speechRate" min="0.5" max="1.5" step="0.1" value="1.0" class="slider">
              <span class="slider-label">1.5x</span>
              <span id="speechRateValue" class="slider-value">1.0x</span>
            </div>
          </div>

          <!-- Narration Voice -->
          <div class="setting-item">
            <label>Narration Voice</label>
            <div class="voice-controls">
              <select id="voiceSelect" class="voice-select">
                <option value="">Loading voices...</option>
              </select>
              <button id="testVoiceBtn" class="test-voice-btn">
                <span class="material-icons">play_arrow</span>
              </button>
            </div>
          </div>

          <!-- App Voice -->
          <div class="setting-item">
            <label>App Voice</label>
            <div class="voice-controls">
              <select id="appVoiceSelect" class="voice-select">
                <option value="">Loading voices...</option>
              </select>
              <button id="testAppVoiceBtn" class="test-voice-btn">
                <span class="material-icons">play_arrow</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Voice & Input Section -->
      <div class="settings-section collapsible collapsed" id="voiceInputSection">
        <h3 class="section-header">
          <span class="material-icons">mic</span> Voice & Input
        </h3>
        <div class="section-content">
          <!-- Tap to Examine toggle (moved to top) -->
          <div class="setting-item">
            <label>
              Tap to Examine
              <input type="checkbox" id="tapToExamineToggle" class="toggle-switch">
            </label>
            <p class="setting-description">Tap words to enter them in the command input</p>
          </div>

          <!-- Push-to-Talk Mode toggle -->
          <div class="setting-item">
            <label>
              Push-to-Talk Mode
              <input type="checkbox" id="pushToTalkToggle" class="toggle-switch">
            </label>
            <p class="setting-description">Hold mic button to speak (recommended for car Bluetooth)</p>
          </div>

          <!-- Voice Controls toggle -->
          <div class="setting-item">
            <label>
              Voice Controls
              <input type="checkbox" id="voiceControlsToggle" class="toggle-switch" checked>
            </label>
            <p class="setting-description">Show voice navigation bar (play, pause, skip controls)</p>
          </div>

          <!-- Voice Commands (collapsible help) -->
          <div class="settings-section collapsible collapsed" id="voiceCommandsSection">
            <h4 class="section-header">Voice Commands</h4>
            <div class="section-content help-content">
              <div class="help-section">
                <strong>Narration Navigation Commands</strong>
                <ul class="help-commands">
                  <li><span class="material-icons">skip_previous</span> <code>"Restart"</code> <code>"Reset"</code> <code>"Repeat"</code></li>
                  <li><span class="material-icons">fast_rewind</span> <code>"Back"</code> <code>"Back 3"</code> <code>"Go Back 5"</code></li>
                  <li><span class="material-icons">pause</span> <code>"Pause"</code></li>
                  <li><span class="material-icons">play_arrow</span> <code>"Play"</code> <code>"Resume"</code></li>
                  <li><span class="material-icons">fast_forward</span> <code>"Skip"</code> <code>"Skip 3"</code> <code>"Forward 5"</code></li>
                  <li><span class="material-icons">skip_next</span> <code>"Stop"</code> <code>"Skip All"</code> <code>"End"</code></li>
                  <li><span class="material-icons">mic</span> <code>"Mute"</code> <code>"Unmute"</code></li>
                </ul>
              </div>
              <div class="help-section">
                <strong>Save/Load Commands</strong>
                <ul class="help-commands">
                  <li><span class="material-icons">save</span> <code>"Quick Save"</code></li>
                  <li><span class="material-icons">restore</span> <code>"Quick Load"</code> <code>"Quick Restore"</code></li>
                </ul>
              </div>
              <div class="help-section">
                <strong>Game Commands</strong>
                <ul class="help-commands">
                  <li><span class="material-icons">keyboard_return</span> <code>"Enter"</code> ‚Äî Press Enter</li>
                  <li><span class="material-icons">info</span> <code>"Status"</code> ‚Äî Dictate in-game status bar</li>
                  <li><span class="material-icons">text_fields</span> <code>"Print [text]"</code> ‚Äî Send literal text</li>
                  <li><span class="material-icons">lightbulb</span> <code>"Get hint"</code> ‚Äî Get AI hint from ChatGPT</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Pronunciation Dictionary -->
          <div class="settings-section collapsible collapsed" id="pronunciationSection">
            <h4 class="section-header">Pronunciation</h4>
            <div class="section-content">
              <p class="setting-description">Fix words that TTS pronounces incorrectly</p>
              <div id="pronunciationList" class="pronunciation-list"></div>
              <div class="add-pronunciation">
                <input type="text" id="newWord" placeholder="Word (e.g., Anchorhead)" class="pronunciation-input">
                <input type="text" id="newPronunciation" placeholder="Say as (e.g., Anchor-head)" class="pronunciation-input">
                <button id="addPronunciationBtn" class="btn-small btn-primary">
                  <span class="material-icons">add</span> Add
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>


      <!-- Saves & Data Section -->
      <div class="settings-section collapsible collapsed" id="savesDataSection">
        <h3 class="section-header">
          <span class="material-icons">storage</span> Saves & Data
        </h3>
        <div class="section-content">
          <!-- Auto-save toggle -->
          <div class="setting-item">
            <label>
              Auto-save
              <input type="checkbox" id="autosaveToggle" class="toggle-switch" checked>
            </label>
            <p class="setting-description">Automatically save after each turn</p>
          </div>

          <!-- Install App button (PWA) -->
          <div id="pwaInstallSection" class="hidden">
            <button id="pwaInstallBtn" class="compact-btn quick-action-btn">
              <span class="material-icons">install_mobile</span> Install App for Offline Use
            </button>
            <p class="setting-description">Install Voxi as a standalone app that works without internet</p>
          </div>

          <!-- Cloud Sync submenu -->
          <div class="settings-section collapsible collapsed" id="cloudSyncSubmenu">
            <h4 class="section-header">Cloud Sync</h4>
            <div class="section-content">
              <!-- Auto-export toggle -->
              <div class="setting-item">
                <label>
                  Auto-export
                  <input type="checkbox" id="autoexportToggle" class="toggle-switch">
                </label>
                <p class="setting-description">Automatically sync saves to Google Drive</p>
              </div>

              <!-- Sign-in area (shown when not signed in) -->
              <div id="gdriveSignInArea">
                <button class="btn btn-primary btn-full-width" id="gdriveSignInBtn">
                  <span class="material-icons">cloud_upload</span>
                  Sign in with Google
                </button>
                <p class="settings-help">
                  Optional: Enable cloud backup and sync across devices
                </p>
              </div>

              <!-- Account area (shown when signed in) -->
              <div id="gdriveAccountArea" class="hidden">
                <div class="gdrive-account-info">
                  <span class="material-icons">account_circle</span>
                  <span id="gdriveEmail">user@example.com</span>
                </div>

                <div class="gdrive-sync-status">
                  <span id="gdriveSyncStatus">Last synced: Never</span>
                </div>

                <div class="game-actions" style="margin-top: 15px;">
                  <button class="btn btn-secondary btn-full-width" id="gdriveSyncToBtn">
                    <span class="material-icons">cloud_upload</span>
                    Sync to Drive
                  </button>
                </div>

                <div class="game-actions" style="margin-top: 10px;">
                  <button class="btn btn-secondary btn-full-width" id="gdriveSyncFromBtn">
                    <span class="material-icons">cloud_download</span>
                    Sync from Drive
                  </button>
                </div>

                <div class="game-actions" style="margin-top: 10px;">
                  <button class="btn btn-secondary btn-full-width" id="gdriveSignOutBtn">
                    <span class="material-icons">logout</span>
                    Sign Out
                  </button>
                </div>
              </div>
            </div>
          </div>

          <!-- View Backup Saves button -->
          <button id="viewBackupSavesBtn" class="compact-btn quick-action-btn game-section-item">
            <span class="material-icons">history</span> View Backup Saves
          </button>

          <!-- Export/Import buttons -->
          <div class="game-section-item">
            <div class="button-group">
              <button id="exportSaveBtn" class="compact-btn quick-action-btn">
                <span class="material-icons">upload</span> Export File
              </button>
              <button id="importSaveBtn" class="compact-btn quick-action-btn">
                <span class="material-icons">download</span> Import File
              </button>
            </div>
          </div>

          <!-- Developer Tools (localhost only, injected by JS) -->
          <div id="devToolsContainer"></div>

          <!-- Save/Restore help info -->
          <div class="settings-section collapsible collapsed" id="saveHelpSection">
            <h4 class="section-header">Save and Restore Help</h4>
            <div class="section-content">
              <div class="save-restore-info">
                <h4>üíæ Save & Restore</h4>
                <p>Progress autosaves after each turn. To save manually:</p>
                <ul>
                  <li><code>save [name]</code> ‚Äî Save with a custom name</li>
                  <li><code>restore [name]</code> ‚Äî Restore from a named save</li>
                  <li><code>quicksave</code> / <code>quickload</code> ‚Äî Quick save/load</li>
                </ul>
              </div>
            </div>
          </div>

          <!-- Reset/Delete buttons (in-game only) -->
          <div class="game-section-item danger-zone">
            <button id="restartGameBtn" class="compact-btn">
              <span class="material-icons">refresh</span> Reset Current Game
            </button>

            <button id="clearAllDataBtn" class="compact-btn danger-btn">
              <span class="material-icons">delete_forever</span> Delete Game Data
            </button>
            <p class="warning-text">Deletes saves for this game only</p>
          </div>

          <!-- Delete All Data (welcome only) -->
          <div id="deleteAllDataSection" class="welcome-section-item danger-zone">
            <button id="deleteAllAppDataBtn" class="compact-btn danger-btn">
              <span class="material-icons">delete_forever</span> Delete All App Data
            </button>
            <p class="warning-text">Removes all games, saves, and settings</p>
          </div>
        </div>
      </div>


    </div>
  </div>

  <div class="container">
    <!-- Welcome Screen -->
    <div class="welcome" id="welcome">
      <button class="welcome-settings-btn" id="welcomeSettingsBtn" title="Settings">
        <span class="material-icons">settings</span>
      </button>
      <h2>Welcome to Voxi</h2>
      <p>Interactive fiction with voice control and narration.</p>

      <div class="game-list">
        <!-- Category 1: Your First Adventure -->
        <div class="game-category">
          <h3 class="category-title">üìú Your First Adventure</h3>
          <p class="category-desc">Welcoming games for new players</p>
          <div class="game-category-grid">
            <button class="game-card" data-game="905.z5">
              <div class="game-title">9:05 <span class="save-badge" data-save-indicator></span><span class="game-meta" data-year="2000" data-author="Adam Cadre" data-difficulty="Relaxed" data-length="Very short (~15-30 min)">‚ìò</span></div>
              <div class="game-desc">Short game with a twist - perfect intro to IF</div>
            </button>
            <button class="game-card" data-game="lostpig.z8">
              <div class="game-title">Lost Pig <span class="save-badge" data-save-indicator></span><span class="game-meta" data-year="2007" data-author="Admiral Jota" data-difficulty="Relaxed" data-length="Short (~30 min - 1.5 hrs)">‚ìò</span></div>
              <div class="game-desc">Comedy adventure - play an orc looking for a pig</div>
            </button>
            <button class="game-card" data-game="dreamhold.z8">
              <div class="game-title">The Dreamhold <span class="save-badge" data-save-indicator></span><span class="game-meta" data-year="2004" data-author="Andrew Plotkin" data-difficulty="Relaxed" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Atmospheric fantasy with relaxed exploration</div>
            </button>
            <button class="game-card" data-game="photopia.z5">
              <div class="game-title">Photopia <span class="save-badge" data-save-indicator></span><span class="game-meta" data-year="1998" data-author="Adam Cadre" data-difficulty="Relaxed" data-length="Short (~30 min - 1.5 hrs)">‚ìò</span></div>
              <div class="game-desc">Award-winning story-driven experience</div>
            </button>
          </div>
        </div>

        <!-- Category 2: Ready for More -->
        <div class="game-category">
          <h3 class="category-title">üöÄ Ready for More</h3>
          <p class="category-desc">Step into more playful, inventive stories</p>
          <div class="game-category-grid">
            <button class="game-card" data-game="wishbringer.z3">
              <div class="game-title">Wishbringer <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1985" data-author="Brian Moriarty" data-difficulty="Engaging" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Beginner-friendly Infocom fantasy adventure</div>
            </button>
            <button class="game-card" data-game="theatre.z5">
              <div class="game-title">Theatre <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1995" data-author="Brendon Wyber" data-difficulty="Engaging" data-length="Short (~30 min - 1.5 hrs)">‚ìò</span></div>
              <div class="game-desc">Backstage mystery at an old playhouse</div>
            </button>
            <button class="game-card" data-game="bronze.zblorb">
              <div class="game-title">Bronze <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="2006" data-author="Emily Short" data-difficulty="Engaging" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Fairy tale retelling - Beauty and the Beast</div>
            </button>
            <button class="game-card" data-game="galatea.zblorb">
              <div class="game-title">Galatea <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="2000" data-author="Emily Short" data-difficulty="Relaxed" data-length="Short (~30 min - 1.5 hrs)">‚ìò</span></div>
              <div class="game-desc">Deep conversation with a statue come to life</div>
            </button>
          </div>
        </div>

        <!-- Category 3: IF Masterpieces -->
        <div class="game-category">
          <h3 class="category-title">‚≠ê IF Masterpieces</h3>
          <p class="category-desc">Iconic works that show the power of the medium</p>
          <div class="game-category-grid">
            <button class="game-card" data-game="curses.z5">
              <div class="game-title">Curses <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1993" data-author="Graham Nelson" data-difficulty="Challenging" data-length="Very long (~10+ hrs)">‚ìò</span></div>
              <div class="game-desc">Puzzle-rich adventure with humor and exploration</div>
            </button>
            <button class="game-card" data-game="trinity.z4">
              <div class="game-title">Trinity <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1986" data-author="Brian Moriarty" data-difficulty="Challenging" data-length="Long (~4-8 hrs)">‚ìò</span></div>
              <div class="game-desc">Cold War time travel - thought-provoking</div>
            </button>
            <button class="game-card" data-game="spiderandweb.z5">
              <div class="game-title">Spider and Web <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1998" data-author="Andrew Plotkin" data-difficulty="Challenging" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Espionage thriller with clever narrative puzzles</div>
            </button>
            <button class="game-card" data-game="anchorhead.z8">
              <div class="game-title">Anchorhead <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1998" data-author="Michael Gentry" data-difficulty="Challenging" data-length="Very long (~10+ hrs)">‚ìò</span></div>
              <div class="game-desc">Lovecraftian horror - atmospheric masterpiece</div>
            </button>
          </div>
        </div>

        <!-- Classics Expander -->
        <div class="classics-expander" id="classicsExpander">
          <button class="classics-toggle" id="classicsToggle">
            <span>Classics &amp; Other Favorites</span>
            <span class="toggle-arrow">‚ñº</span>
          </button>
          <div class="classics-content">
            <button class="game-card" data-game="aisle.z5">
              <div class="game-title">Aisle <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1999" data-author="Sam Barlow" data-difficulty="Relaxed" data-length="Very short (~15-30 min)">‚ìò</span></div>
              <div class="game-desc">One move, many endings</div>
            </button>
            <button class="game-card" data-game="allroads.z5">
              <div class="game-title">All Roads <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="2001" data-author="Jon Ingold" data-difficulty="Engaging" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Venice time-loop mystery</div>
            </button>
            <button class="game-card" data-game="amfv.z4">
              <div class="game-title">A Mind Forever Voyaging <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1985" data-author="Steve Meretzky" data-difficulty="Engaging" data-length="Long (~4-8 hrs)">‚ìò</span></div>
              <div class="game-desc">Dystopian AI simulation - Infocom's boldest</div>
            </button>
            <button class="game-card" data-game="zork.z5">
              <div class="game-title">Dungeon (Zork) <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1977" data-author="MIT (Lebling, Blank, et al.)" data-difficulty="Challenging" data-length="Very long (~10+ hrs)">‚ìò</span></div>
              <div class="game-desc">The original MIT mainframe classic</div>
            </button>
            <button class="game-card" data-game="edifice.z5">
              <div class="game-title">The Edifice <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1997" data-author="Lucian Smith" data-difficulty="Engaging" data-length="Short (~30 min - 1.5 hrs)">‚ìò</span></div>
              <div class="game-desc">Evolution of language puzzles</div>
            </button>
            <button class="game-card" data-game="hitchhik.z5">
              <div class="game-title">Hitchhiker's Guide <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1984" data-author="Douglas Adams & Steve Meretzky" data-difficulty="Notorious" data-length="Very long (~10+ hrs)">‚ìò</span></div>
              <div class="game-desc">Douglas Adams' comedic sci-fi classic</div>
            </button>
            <button class="game-card" data-game="jigsaw.z8">
              <div class="game-title">Jigsaw <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1995" data-author="Graham Nelson" data-difficulty="Challenging" data-length="Very long (~10+ hrs)">‚ìò</span></div>
              <div class="game-desc">Time-travel through historical moments</div>
            </button>
            <button class="game-card" data-game="metamorphoses.z5">
              <div class="game-title">Metamorphoses <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="2000" data-author="Emily Short" data-difficulty="Engaging" data-length="Short (~30 min - 1.5 hrs)">‚ìò</span></div>
              <div class="game-desc">Surreal transformations and discovery</div>
            </button>
            <button class="game-card" data-game="planetfall.z3">
              <div class="game-title">Planetfall <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1983" data-author="Steve Meretzky" data-difficulty="Engaging" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Sci-fi comedy with Floyd the robot</div>
            </button>
            <button class="game-card" data-game="savoirfaire.zblorb">
              <div class="game-title">Savoir-Faire <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="2002" data-author="Emily Short" data-difficulty="Challenging" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Magical puzzle adventure</div>
            </button>
            <button class="game-card" data-game="seastalker.z3">
              <div class="game-title">Seastalker <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1984" data-author="Stu Galley & Jim Lawrence" data-difficulty="Relaxed" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Kid-friendly underwater sci-fi adventure</div>
            </button>
            <button class="game-card" data-game="shade.z5">
              <div class="game-title">Shade <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="2000" data-author="Andrew Plotkin" data-difficulty="Engaging" data-length="Short (~30 min - 1.5 hrs)">‚ìò</span></div>
              <div class="game-desc">Surreal one-room mystery by Plotkin</div>
            </button>
            <button class="game-card" data-game="slouching.z5">
              <div class="game-title">Slouching Towards Bedlam <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="2003" data-author="Star Foster & Daniel Ravipinto" data-difficulty="Engaging" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Steampunk mystery - award winner</div>
            </button>
            <button class="game-card" data-game="varicella.z8">
              <div class="game-title">Varicella <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1999" data-author="Adam Cadre" data-difficulty="Challenging" data-length="Long (~4-8 hrs)">‚ìò</span></div>
              <div class="game-desc">Palace intrigue time-loop thriller</div>
            </button>
            <button class="game-card" data-game="violet.zblorb">
              <div class="game-title">Violet <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="2008" data-author="Jeremy Freese" data-difficulty="Engaging" data-length="Short (~30 min - 1.5 hrs)">‚ìò</span></div>
              <div class="game-desc">One-room puzzle game with a unique voice</div>
            </button>
            <button class="game-card" data-game="witness.z3">
              <div class="game-title">The Witness <span class="save-badge" data-save-indicator></span> <span class="game-meta" data-year="1983" data-author="Stu Galley" data-difficulty="Engaging" data-length="Medium (~1.5-4 hrs)">‚ìò</span></div>
              <div class="game-desc">Infocom noir detective - murder mystery</div>
            </button>
          </div>
        </div>

        <!-- IF Database Link + Custom URL -->
        <div class="if-database-section">
          <p>Want more? Browse thousands of games at the <a href="https://ifdb.org/" target="_blank" rel="noopener">Interactive Fiction Database</a></p>
          <div class="custom-url-section">
            <h4>Or play any Z-machine game by URL:</h4>
            <form class="custom-url-form" id="customUrlForm">
              <input type="url"
                     class="custom-url-input"
                     id="customUrlInput"
                     placeholder="https://ifarchive.org/if-archive/games/zcode/LostPig.z8"
                     autocomplete="off">
              <button type="submit" class="custom-url-btn">
                <span class="material-icons">play_arrow</span>
                Play
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- Game Output -->
    <div class="game-output hidden" id="gameOutput">
      <!-- Three-primitive Z-machine window model -->
      <div class="status-bar" id="statusBar"></div>
      <div class="upper-window" id="upperWindow"></div>
      <div class="lower-window" id="lowerWindow">
        <!-- Inline command input (hidden by default) -->
        <div class="command-line" id="commandLine" style="display: none;">
          <span class="command-prompt">&gt;</span>
          <input type="text" class="command-text" id="commandText" autocomplete="off" spellcheck="false">
          <span class="voice-indicator" id="voiceIndicator" title="Voice command">
            <span class="material-icons">mic</span>
          </span>
        </div>
      </div>
    </div>
  </div>

  <!-- Controls Panel -->
  <div class="controls-wrapper">
    <!-- Navigation Controls -->
    <div class="controls hidden" id="controls">
      <button id="skipToStartBtn" class="btn-nav" title="&quot;Restart&quot;"><span class="material-icons">skip_previous</span></button>
      <button id="prevChunkBtn" class="btn-nav" title="&quot;Back&quot;"><span class="material-icons">fast_rewind</span></button>
      <button id="pausePlayBtn" class="btn-nav" title="&quot;Play&quot;"><span class="material-icons">play_arrow</span></button>
      <button id="nextChunkBtn" class="btn-nav" title="&quot;Skip&quot;"><span class="material-icons">fast_forward</span></button>
      <button id="skipToEndBtn" class="btn-nav" title="&quot;Skip All&quot;"><span class="material-icons">skip_next</span></button>
      <div class="controls-spacer"></div>
      <button id="muteBtn" class="btn-mic" title="Mute Mic (toggle microphone)"><span class="material-icons">mic</span></button>
    </div>

    <!-- Message Input Row -->
    <div class="message-input-row hidden" id="messageInputRow">
      <!-- Input container with embedded clear button -->
      <div class="input-container">
        <!-- Text input (shown when muted) -->
        <input type="text" class="message-input" id="messageInput" placeholder="Type a command..." autocomplete="off" spellcheck="false">
        <!-- Voice listening indicator (shown when unmuted) -->
        <div class="voice-listening-indicator hidden" id="voiceListeningIndicator">
          <span class="voice-meter-dot" id="voiceMeterDot"></span>
          <span class="voice-transcript" id="voiceTranscript">Listening...</span>
        </div>
        <!-- Clear button (inside input, always visible for clearing input or canceling system mode) -->
        <button class="btn-clear-inline" id="clearInputBtn" title="Clear (Esc)" aria-label="Clear input">
          <span class="material-icons">close</span>
        </button>
      </div>
      <!-- Send button (outside input, where X used to be) -->
      <button class="btn-nav" id="sendBtn" title="Send (Enter)" aria-label="Send command">
        <span class="material-icons">send</span>
      </button>
      <!-- Settings button (always on the right) -->
      <button id="settingsBtn" class="btn-nav btn-settings" title="Settings"><span class="material-icons">settings</span></button>
    </div>

    <!-- Char Input Panel (replaces message input in char mode) -->
    <div class="char-input-panel hidden" id="charInputPanel">
      <!-- Arrow navigation -->
      <button class="btn-char-nav" id="charLeftBtn" title="Left Arrow" aria-label="Left Arrow">
        <span class="material-icons">arrow_back</span>
      </button>
      <button class="btn-char-nav" id="charUpBtn" title="Up Arrow" aria-label="Up Arrow">
        <span class="material-icons">arrow_upward</span>
      </button>
      <button class="btn-char-nav" id="charDownBtn" title="Down Arrow" aria-label="Down Arrow">
        <span class="material-icons">arrow_downward</span>
      </button>
      <button class="btn-char-nav" id="charRightBtn" title="Right Arrow" aria-label="Right Arrow">
        <span class="material-icons">arrow_forward</span>
      </button>

      <!-- Spacer to push Enter to the right -->
      <div class="char-input-spacer"></div>

      <!-- Keyboard button (opens virtual keyboard) -->
      <button class="btn-char-action" id="charKeyboardBtn" title="Type any key" aria-label="Open Keyboard">
        <span class="material-icons">keyboard</span>
      </button>

      <!-- Escape button -->
      <button class="btn-char-action" id="charEscBtn" title="Escape" aria-label="Escape Key">
        Esc
      </button>

      <!-- Enter button (rightmost, like Send button) -->
      <button class="btn-char-action btn-char-enter" id="charEnterBtn" title="Enter" aria-label="Enter Key">
        <span class="material-icons">send</span>
      </button>
    </div>
  </div>
</div>
  


  <div class="status" id="status">Select a game to start</div>

  <!-- Lock Screen Overlay -->
  <div class="lock-screen-overlay hidden" id="lockScreenOverlay">
    <div class="lock-screen-content">
      <div class="lock-screen-icon">
        <span class="material-icons">lock</span>
      </div>
      <div class="lock-screen-listening-indicator hidden" id="lockListeningIndicator">
        <span class="material-icons mic-pulse">mic</span>
        <span class="listening-text">Listening...</span>
      </div>
      <div class="lock-screen-muted-indicator hidden" id="lockMutedIndicator">
        <span class="material-icons">mic_off</span>
        <span class="muted-text">Microphone Muted</span>
      </div>
      <div class="lock-screen-instructions">
        Say "unlock" or press and hold
      </div>
      <div class="lock-screen-transcript hidden" id="lockTranscript"></div>
      <button class="unlock-button" id="unlockButton">
        <div class="unlock-button-inner">
          <span class="material-icons">lock_open</span>
          <span class="unlock-text">Hold to Unlock</span>
        </div>
        <div class="unlock-progress" id="unlockProgress"></div>
      </button>
    </div>
  </div>

  <!-- Confirm Dialog -->
  <div class="confirm-dialog-overlay hidden" id="confirmDialogOverlay">
    <div class="confirm-dialog">
      <h3 class="confirm-dialog-title" id="confirmDialogTitle">Confirm</h3>
      <p class="confirm-dialog-message" id="confirmDialogMessage">
        Are you sure?
      </p>
      <div class="confirm-dialog-buttons">
        <button class="btn-confirm-cancel" id="confirmCancelBtn">Cancel</button>
        <button class="btn-confirm-ok" id="confirmOkBtn">OK</button>
      </div>
    </div>
  </div>

  <script type="module" src="js/app.js"></script>
</body>
</html>

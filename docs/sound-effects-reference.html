<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>IFTalk - Sound Effects Reference</title>
  <style>
    :root {
      --bg-primary: #1a1a1a;
      --bg-surface: #2a2a2a;
      --bg-elevated: #353535;
      --text-primary: #ffffff;
      --text-muted: #888888;
      --accent-primary: #5b8dd6;
      --accent-warm: #e8b86d;
      --border-subtle: #444444;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: var(--bg-primary);
      color: var(--text-primary);
      padding: 40px 20px;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
    }

    h1 {
      text-align: center;
      margin-bottom: 16px;
      color: var(--accent-primary);
    }

    .subtitle {
      text-align: center;
      color: var(--text-muted);
      margin-bottom: 40px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin-bottom: 40px;
      padding: 20px;
      background: var(--bg-surface);
      border-radius: 12px;
    }

    .volume-control {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .volume-control label {
      color: var(--text-muted);
    }

    input[type="range"] {
      width: 200px;
    }

    .effects-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 20px;
    }

    .effect-card {
      background: var(--bg-surface);
      border: 1px solid var(--border-subtle);
      border-radius: 12px;
      padding: 24px;
      transition: all 0.2s ease;
    }

    .effect-card:hover {
      border-color: var(--accent-primary);
      transform: translateY(-2px);
    }

    .effect-header {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px;
    }

    .effect-title {
      font-size: 1.2em;
      font-weight: 600;
      color: var(--accent-warm);
    }

    .play-btn {
      background: var(--accent-primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 8px 20px;
      cursor: pointer;
      font-size: 0.9em;
      font-weight: 500;
      transition: all 0.2s ease;
    }

    .play-btn:hover {
      background: #4a74ce;
      transform: scale(1.05);
    }

    .play-btn:active {
      transform: scale(0.95);
    }

    .effect-event {
      color: var(--text-muted);
      font-size: 0.95em;
      margin-bottom: 12px;
      font-style: italic;
    }

    .effect-specs {
      background: var(--bg-elevated);
      padding: 12px;
      border-radius: 6px;
      font-size: 0.85em;
      color: var(--text-muted);
      font-family: 'Courier New', monospace;
    }

    .spec-row {
      display: flex;
      justify-content: space-between;
      padding: 4px 0;
    }

    .spec-label {
      color: var(--text-muted);
    }

    .spec-value {
      color: var(--text-primary);
      font-weight: 500;
    }

    .play-all-btn {
      display: block;
      margin: 40px auto;
      background: var(--accent-warm);
      color: var(--bg-primary);
      border: none;
      border-radius: 8px;
      padding: 16px 40px;
      cursor: pointer;
      font-size: 1.1em;
      font-weight: 600;
      transition: all 0.2s ease;
    }

    .play-all-btn:hover {
      background: #f0c47f;
      transform: scale(1.05);
    }

    .footer {
      text-align: center;
      margin-top: 60px;
      color: var(--text-muted);
      font-size: 0.9em;
    }

    /* Sound Editor Styles */
    .editor-section {
      background: var(--bg-surface);
      border: 2px solid var(--accent-primary);
      border-radius: 12px;
      padding: 24px;
      margin-bottom: 40px;
    }

    .editor-title {
      font-size: 1.4em;
      font-weight: 600;
      color: var(--accent-primary);
      margin-bottom: 8px;
    }

    .editor-subtitle {
      color: var(--text-muted);
      margin-bottom: 20px;
      font-size: 0.95em;
    }

    .editor-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 16px;
      margin-bottom: 20px;
    }

    .editor-control {
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .editor-control label {
      color: var(--text-muted);
      font-size: 0.9em;
      font-weight: 500;
    }

    .editor-control input[type="number"],
    .editor-control select {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      padding: 8px 12px;
      font-size: 0.95em;
    }

    .editor-control input[type="number"]:focus,
    .editor-control select:focus {
      outline: none;
      border-color: var(--accent-primary);
    }

    .editor-actions {
      display: flex;
      gap: 12px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    .editor-btn {
      background: var(--accent-primary);
      color: white;
      border: none;
      border-radius: 8px;
      padding: 12px 24px;
      cursor: pointer;
      font-size: 1em;
      font-weight: 500;
      transition: all 0.2s ease;
      flex: 1;
      min-width: 150px;
    }

    .editor-btn:hover {
      background: #4a74ce;
      transform: translateY(-1px);
    }

    .editor-btn.secondary {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
    }

    .editor-btn.secondary:hover {
      background: var(--border-subtle);
    }

    .paste-command {
      background: var(--bg-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      padding: 16px;
      margin-top: 16px;
      font-family: 'Courier New', monospace;
      font-size: 0.9em;
      color: var(--accent-warm);
      white-space: pre;
      overflow-x: auto;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .paste-command:hover {
      border-color: var(--accent-primary);
      background: var(--bg-elevated);
    }

    .paste-command.copied {
      border-color: #4ade80;
      background: rgba(74, 222, 128, 0.1);
    }

    .load-btn {
      background: var(--bg-elevated);
      color: var(--text-primary);
      border: 1px solid var(--border-subtle);
      border-radius: 6px;
      padding: 6px 16px;
      cursor: pointer;
      font-size: 0.85em;
      font-weight: 500;
      transition: all 0.2s ease;
      margin-left: 8px;
    }

    .load-btn:hover {
      background: var(--border-subtle);
      border-color: var(--accent-primary);
    }

    .editor-current-sound {
      color: var(--accent-warm);
      font-size: 0.9em;
      margin-bottom: 12px;
      font-style: italic;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>ðŸ”Š IFTalk Sound Effects Reference</h1>
    <p class="subtitle">All audio feedback sounds used throughout the app</p>

    <div class="controls">
      <div class="volume-control">
        <label for="masterVolume">Master Volume:</label>
        <input type="range" id="masterVolume" min="0" max="100" value="100">
        <span id="volumeValue">100%</span>
      </div>
    </div>

    <!-- Sound Editor -->
    <div class="editor-section">
      <div class="editor-title">ðŸŽµ Sound Editor</div>
      <div class="editor-subtitle">Create and test custom sound effects. Click "Load" on any sound below to edit it.</div>

      <div class="editor-current-sound" id="currentSound">No sound loaded - click Load on any sound below</div>

      <div class="editor-grid">
        <div class="editor-control">
          <label for="editFreq">Frequency (Hz)</label>
          <input type="number" id="editFreq" value="600" min="50" max="2000" step="10">
        </div>

        <div class="editor-control">
          <label for="editWave">Wave Type</label>
          <select id="editWave">
            <option value="sine">Sine</option>
            <option value="square">Square</option>
            <option value="sawtooth">Sawtooth</option>
            <option value="triangle">Triangle</option>
          </select>
        </div>

        <div class="editor-control">
          <label for="editDuration">Duration (ms)</label>
          <input type="number" id="editDuration" value="20" min="10" max="500" step="10">
        </div>

        <div class="editor-control">
          <label for="editVolume">Volume (0-1)</label>
          <input type="number" id="editVolume" value="0.25" min="0.01" max="1" step="0.01">
        </div>

        <div class="editor-control">
          <label for="editAttack">Attack (ms)</label>
          <input type="number" id="editAttack" value="0" min="0" max="100" step="5">
        </div>

        <div class="editor-control">
          <label for="editDecay">Decay (ms)</label>
          <input type="number" id="editDecay" value="0" min="0" max="100" step="5">
        </div>
      </div>

      <div class="editor-subtitle" style="margin-top: 16px; margin-bottom: 12px; font-size: 0.9em;">
        Multi-Tone Pattern (optional - leave blank for single tone)
      </div>

      <div class="editor-grid">
        <div class="editor-control">
          <label for="editFreq2">Tone 2 Frequency (Hz)</label>
          <input type="number" id="editFreq2" value="" min="50" max="2000" step="10" placeholder="Optional">
        </div>

        <div class="editor-control">
          <label for="editDelay2">Tone 2 Delay (ms)</label>
          <input type="number" id="editDelay2" value="50" min="0" max="300" step="10" placeholder="After tone 1">
        </div>

        <div class="editor-control">
          <label for="editFreq3">Tone 3 Frequency (Hz)</label>
          <input type="number" id="editFreq3" value="" min="50" max="2000" step="10" placeholder="Optional">
        </div>

        <div class="editor-control">
          <label for="editDelay3">Tone 3 Delay (ms)</label>
          <input type="number" id="editDelay3" value="100" min="0" max="300" step="10" placeholder="After tone 1">
        </div>
      </div>

      <div class="editor-actions">
        <button class="editor-btn" onclick="playCustomSound()">â–¶ Play Custom Sound</button>
        <button class="editor-btn secondary" onclick="generatePasteCommand()">ðŸ“‹ Copy Paste Command</button>
      </div>

      <div class="paste-command" id="pasteCommand" onclick="copyPasteCommand()" style="display: none;">
        Click to copy...
      </div>
    </div>

    <div class="effects-grid">
      <!-- Command Sent -->
      <div class="effect-card">
        <div class="effect-header">
          <div>
            <div class="effect-title">Command Sent (Subtle Pop)</div>
            <div class="effect-event">When: Game command is sent (e.g., "look", "take sword")</div>
          </div>
          <div>
            <button class="play-btn" onclick="playCommandSent()">Play</button>
            <button class="load-btn" onclick="loadSound('commandSent', {freq: 600, wave: 'sine', duration: 20, volume: 0.25, attack: 0, decay: 0})">Load</button>
          </div>
        </div>
        <div class="effect-specs">
          <div class="spec-row">
            <span class="spec-label">Type:</span>
            <span class="spec-value">Subtle pop</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Frequency:</span>
            <span class="spec-value">600 Hz</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Wave:</span>
            <span class="spec-value">Sine</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Duration:</span>
            <span class="spec-value">20ms</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Envelope:</span>
            <span class="spec-value">Instant (sharp attack/decay)</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Volume:</span>
            <span class="spec-value">0.25</span>
          </div>
        </div>
      </div>

      <!-- App Command -->
      <div class="effect-card">
        <div class="effect-header">
          <div>
            <div class="effect-title">App Command (Soft Pulse)</div>
            <div class="effect-event">When: Navigation/app command (e.g., "pause", "restart", "skip")</div>
          </div>
          <div>
            <button class="play-btn" onclick="playAppCommand()">Play</button>
            <button class="load-btn" onclick="loadSound('appCommand', {freq: 460, wave: 'sine', duration: 100, volume: 0.10, attack: 30, decay: 0})">Load</button>
          </div>
        </div>
        <div class="effect-specs">
          <div class="spec-row">
            <span class="spec-label">Type:</span>
            <span class="spec-value">Soft pulse</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Frequency:</span>
            <span class="spec-value">460 Hz</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Wave:</span>
            <span class="spec-value">Sine</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Duration:</span>
            <span class="spec-value">100ms</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Attack:</span>
            <span class="spec-value">30ms (soft fade in)</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Envelope:</span>
            <span class="spec-value">Exponential (gentle decay)</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Volume:</span>
            <span class="spec-value">0.10</span>
          </div>
        </div>
      </div>

      <!-- Low Confidence -->
      <div class="effect-card">
        <div class="effect-header">
          <div>
            <div class="effect-title">Low Confidence Warning</div>
            <div class="effect-event">When: Voice recognition confidence < 50%</div>
          </div>
          <div>
            <button class="play-btn" onclick="playLowConfidence()">Play</button>
            <button class="load-btn" onclick="loadSound('lowConfidence', {freq: 200, wave: 'sine', duration: 200, volume: 0.3, attack: 0, decay: 0})">Load</button>
          </div>
        </div>
        <div class="effect-specs">
          <div class="spec-row">
            <span class="spec-label">Type:</span>
            <span class="spec-value">Gentle warble</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Frequency:</span>
            <span class="spec-value">200 Hz (Â±20 Hz wobble)</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Wave:</span>
            <span class="spec-value">Sine with 8Hz LFO</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Duration:</span>
            <span class="spec-value">200ms</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Volume:</span>
            <span class="spec-value">0.3</span>
          </div>
        </div>
      </div>

      <!-- Blocked Command -->
      <div class="effect-card">
        <div class="effect-header">
          <div>
            <div class="effect-title">Blocked Command</div>
            <div class="effect-event">When: Command rejected (invalid, system busy, etc.)</div>
          </div>
          <div>
            <button class="play-btn" onclick="playBlockedCommand()">Play</button>
            <button class="load-btn" onclick="loadSound('blockedCommand', {freq: 150, wave: 'sawtooth', duration: 150, volume: 0.40, attack: 0, decay: 0})">Load</button>
          </div>
        </div>
        <div class="effect-specs">
          <div class="spec-row">
            <span class="spec-label">Type:</span>
            <span class="spec-value">Soft buzz</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Frequency:</span>
            <span class="spec-value">150 Hz</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Wave:</span>
            <span class="spec-value">Sawtooth</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Duration:</span>
            <span class="spec-value">150ms</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Volume:</span>
            <span class="spec-value">0.40</span>
          </div>
        </div>
      </div>

      <!-- Mute Tone -->
      <div class="effect-card">
        <div class="effect-header">
          <div>
            <div class="effect-title">Mute Mic</div>
            <div class="effect-event">When: Microphone muted</div>
          </div>
          <div>
            <button class="play-btn" onclick="playMuteTone()">Play</button>
            <button class="load-btn" onclick="loadSound('muteTone', {freq: 300, wave: 'sine', duration: 40, volume: 0.3, attack: 0, decay: 0, freq2: 250, delay2: 50, freq3: 200, delay3: 100})">Load</button>
          </div>
        </div>
        <div class="effect-specs">
          <div class="spec-row">
            <span class="spec-label">Type:</span>
            <span class="spec-value">Triple tap descending</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Frequency:</span>
            <span class="spec-value">300 â†’ 250 â†’ 200 Hz</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Wave:</span>
            <span class="spec-value">Sine (3 taps)</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Duration:</span>
            <span class="spec-value">40ms per tap</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Volume:</span>
            <span class="spec-value">0.3</span>
          </div>
        </div>
      </div>

      <!-- Unmute Tone -->
      <div class="effect-card">
        <div class="effect-header">
          <div>
            <div class="effect-title">Unmute Mic</div>
            <div class="effect-event">When: Microphone unmuted</div>
          </div>
          <div>
            <button class="play-btn" onclick="playUnmuteTone()">Play</button>
            <button class="load-btn" onclick="loadSound('unmuteTone', {freq: 660, wave: 'sine', duration: 150, volume: 0.12, attack: 0, decay: 0, freq2: 880, delay2: 80})">Load</button>
          </div>
        </div>
        <div class="effect-specs">
          <div class="spec-row">
            <span class="spec-label">Type:</span>
            <span class="spec-value">Ascending chime</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Frequency:</span>
            <span class="spec-value">660 Hz + 880 Hz</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Wave:</span>
            <span class="spec-value">Sine (2 notes)</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Duration:</span>
            <span class="spec-value">150ms + 170ms</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Volume:</span>
            <span class="spec-value">0.12</span>
          </div>
        </div>
      </div>

      <!-- System Beep -->
      <div class="effect-card">
        <div class="effect-header">
          <div>
            <div class="effect-title">System Message Beep</div>
            <div class="effect-event">When: Before system message narration (e.g., save/restore prompts)</div>
          </div>
          <div>
            <button class="play-btn" onclick="playSystemBeep()">Play</button>
            <button class="load-btn" onclick="loadSound('systemBeep', {freq: 800, wave: 'sine', duration: 80, volume: 0.15, attack: 0, decay: 0})">Load</button>
          </div>
        </div>
        <div class="effect-specs">
          <div class="spec-row">
            <span class="spec-label">Type:</span>
            <span class="spec-value">Clean neutral beep</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Frequency:</span>
            <span class="spec-value">800 Hz</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Wave:</span>
            <span class="spec-value">Sine</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Duration:</span>
            <span class="spec-value">80ms</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Envelope:</span>
            <span class="spec-value">Exponential (gentle decay)</span>
          </div>
          <div class="spec-row">
            <span class="spec-label">Volume:</span>
            <span class="spec-value">0.15</span>
          </div>
        </div>
      </div>
    </div>

    <button class="play-all-btn" onclick="playAllSequence()">â–¶ Play All Sounds in Sequence</button>

    <div class="footer">
      <p>IFTalk Audio Feedback System â€¢ All sounds generated with Web Audio API</p>
      <p style="margin-top: 8px; font-size: 0.85em;">Sounds respect master volume and sound effects toggle from settings</p>
    </div>
  </div>

  <script>
    // Audio context
    let audioCtx = null;

    function getContext() {
      if (!audioCtx) {
        audioCtx = new (window.AudioContext || window.webkitAudioContext)();
      }
      if (audioCtx.state === 'suspended') {
        audioCtx.resume();
      }
      return audioCtx;
    }

    // Master volume control
    const volumeSlider = document.getElementById('masterVolume');
    const volumeValue = document.getElementById('volumeValue');

    volumeSlider.addEventListener('input', (e) => {
      volumeValue.textContent = e.target.value + '%';
    });

    function getMasterVolume() {
      return parseInt(volumeSlider.value) / 100;
    }

    // Sound effect functions (copied from audio-feedback.js)
    function playCommandSent() {
      try {
        const ctx = getContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const masterVol = getMasterVolume();

        osc.connect(gain);
        gain.connect(ctx.destination);

        // Subtle Pop (Sound #8): Very short, barely-there click
        osc.frequency.value = 600;
        osc.type = 'sine';

        // Instant envelope - sharp attack and decay
        gain.gain.setValueAtTime(0.25 * masterVol, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.02);

        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.02);
      } catch (err) {
        console.error('Command sent tone error:', err);
      }
    }

    function playAppCommand() {
      try {
        const ctx = getContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const masterVol = getMasterVolume();

        osc.connect(gain);
        gain.connect(ctx.destination);

        // Soft Pulse: Gentle, quiet pulse
        osc.frequency.value = 460;
        osc.type = 'sine';

        // Soft envelope with slow attack
        const now = ctx.currentTime;
        gain.gain.setValueAtTime(0, now);
        gain.gain.linearRampToValueAtTime(0.10 * masterVol, now + 0.030);
        gain.gain.exponentialRampToValueAtTime(0.01, now + 0.100);

        osc.start(now);
        osc.stop(now + 0.100);
      } catch (err) {
        console.error('App command tone error:', err);
      }
    }

    function playLowConfidence() {
      try {
        const ctx = getContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const lfo = ctx.createOscillator();
        const lfoGain = ctx.createGain();
        const masterVol = getMasterVolume();

        lfo.connect(lfoGain);
        lfoGain.connect(osc.frequency);
        osc.connect(gain);
        gain.connect(ctx.destination);

        osc.frequency.value = 200;
        lfo.frequency.value = 8;
        lfoGain.gain.value = 20;
        osc.type = 'sine';

        gain.gain.setValueAtTime(0.3 * masterVol, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.2);

        lfo.start(ctx.currentTime);
        osc.start(ctx.currentTime);
        lfo.stop(ctx.currentTime + 0.2);
        osc.stop(ctx.currentTime + 0.2);
      } catch (err) {
        console.error('Low confidence tone error:', err);
      }
    }

    function playBlockedCommand() {
      try {
        const ctx = getContext();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        const masterVol = getMasterVolume();

        osc.connect(gain);
        gain.connect(ctx.destination);

        osc.frequency.value = 150;
        osc.type = 'sawtooth';

        gain.gain.setValueAtTime(0.40 * masterVol, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);

        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.15);
      } catch (err) {
        console.error('Blocked command tone error:', err);
      }
    }

    function playMuteTone() {
      try {
        const ctx = getContext();
        const masterVol = getMasterVolume();
        const freqs = [300, 250, 200];
        freqs.forEach((freq, i) => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();
          osc.connect(gain);
          gain.connect(ctx.destination);
          osc.frequency.value = freq;
          osc.type = 'sine';
          const start = ctx.currentTime + i * 0.05;
          gain.gain.setValueAtTime(0.3 * masterVol, start);
          gain.gain.exponentialRampToValueAtTime(0.001, start + 0.04);
          osc.start(start);
          osc.stop(start + 0.04);
        });
      } catch (err) {
        console.error('Mute tone error:', err);
      }
    }

    function playUnmuteTone() {
      try {
        const ctx = getContext();
        const masterVol = getMasterVolume();
        // First note
        const osc1 = ctx.createOscillator();
        const gain1 = ctx.createGain();
        osc1.connect(gain1);
        gain1.connect(ctx.destination);
        osc1.frequency.value = 660;
        osc1.type = 'sine';
        gain1.gain.setValueAtTime(0.12 * masterVol, ctx.currentTime);
        gain1.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
        osc1.start(ctx.currentTime);
        osc1.stop(ctx.currentTime + 0.15);
        // Second note
        const osc2 = ctx.createOscillator();
        const gain2 = ctx.createGain();
        osc2.connect(gain2);
        gain2.connect(ctx.destination);
        osc2.frequency.value = 880;
        osc2.type = 'sine';
        gain2.gain.setValueAtTime(0.12 * masterVol, ctx.currentTime + 0.08);
        gain2.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.25);
        osc2.start(ctx.currentTime + 0.08);
        osc2.stop(ctx.currentTime + 0.25);
      } catch (err) {
        console.error('Unmute tone error:', err);
      }
    }

    function playSystemBeep() {
      try {
        const ctx = getContext();
        const masterVol = getMasterVolume();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();

        osc.connect(gain);
        gain.connect(ctx.destination);

        // Clean, neutral beep
        osc.frequency.value = 800;
        osc.type = 'sine';

        const now = ctx.currentTime;
        gain.gain.setValueAtTime(0.15 * masterVol, now);
        gain.gain.exponentialRampToValueAtTime(0.001, now + 0.08);

        osc.start(now);
        osc.stop(now + 0.08);
      } catch (err) {
        console.error('System beep error:', err);
      }
    }

    // Editor state
    let currentSoundName = null;
    let currentSoundId = null;

    // Load sound into editor
    function loadSound(soundId, params) {
      currentSoundId = soundId;

      // Update primary tone values
      document.getElementById('editFreq').value = params.freq;
      document.getElementById('editWave').value = params.wave;
      document.getElementById('editDuration').value = params.duration;
      document.getElementById('editVolume').value = params.volume;
      document.getElementById('editAttack').value = params.attack || 0;
      document.getElementById('editDecay').value = params.decay || 0;

      // Clear multi-tone fields first
      document.getElementById('editFreq2').value = '';
      document.getElementById('editFreq3').value = '';
      document.getElementById('editDelay2').value = 50;
      document.getElementById('editDelay3').value = 100;

      // Load multi-tone values if present
      if (params.freq2) {
        document.getElementById('editFreq2').value = params.freq2;
        document.getElementById('editDelay2').value = params.delay2 || 50;
      }
      if (params.freq3) {
        document.getElementById('editFreq3').value = params.freq3;
        document.getElementById('editDelay3').value = params.delay3 || 100;
      }

      // Update current sound label
      const soundNames = {
        commandSent: 'Command Sent',
        appCommand: 'App Command',
        lowConfidence: 'Low Confidence',
        blockedCommand: 'Blocked Command',
        muteTone: 'Mute Mic',
        unmuteTone: 'Unmute Mic',
        systemBeep: 'System Message Beep'
      };
      currentSoundName = soundNames[soundId];
      document.getElementById('currentSound').textContent = `Editing: ${currentSoundName}`;

      // Scroll to editor
      document.querySelector('.editor-section').scrollIntoView({ behavior: 'smooth', block: 'nearest' });
    }

    // Play custom sound with current editor values
    function playCustomSound() {
      try {
        const ctx = getContext();
        const masterVol = getMasterVolume();

        // Get primary tone values
        const freq = parseFloat(document.getElementById('editFreq').value);
        const wave = document.getElementById('editWave').value;
        const duration = parseFloat(document.getElementById('editDuration').value) / 1000;
        const volume = parseFloat(document.getElementById('editVolume').value);
        const attack = parseFloat(document.getElementById('editAttack').value) / 1000;
        const decay = parseFloat(document.getElementById('editDecay').value) / 1000;

        // Check for multi-tone pattern
        const freq2 = document.getElementById('editFreq2').value;
        const freq3 = document.getElementById('editFreq3').value;
        const delay2 = parseFloat(document.getElementById('editDelay2').value) / 1000;
        const delay3 = parseFloat(document.getElementById('editDelay3').value) / 1000;

        // Collect all tones to play
        const tones = [{ freq, delay: 0 }];
        if (freq2) tones.push({ freq: parseFloat(freq2), delay: delay2 });
        if (freq3) tones.push({ freq: parseFloat(freq3), delay: delay3 });

        // Play each tone
        tones.forEach(tone => {
          const osc = ctx.createOscillator();
          const gain = ctx.createGain();

          osc.connect(gain);
          gain.connect(ctx.destination);

          osc.frequency.value = tone.freq;
          osc.type = wave;

          const now = ctx.currentTime + tone.delay;

          // Apply ADSR envelope
          if (attack > 0) {
            // Attack phase
            gain.gain.setValueAtTime(0, now);
            gain.gain.linearRampToValueAtTime(volume * masterVol, now + attack);
          } else {
            // Instant attack
            gain.gain.setValueAtTime(volume * masterVol, now);
          }

          // Decay phase (if specified)
          if (decay > 0 && attack > 0) {
            const sustainLevel = volume * masterVol * 0.7; // Sustain at 70% of peak
            gain.gain.linearRampToValueAtTime(sustainLevel, now + attack + decay);
            gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
          } else {
            // Just exponential release
            const releaseStart = attack > 0 ? now + attack : now;
            gain.gain.exponentialRampToValueAtTime(0.001, now + duration);
          }

          osc.start(now);
          osc.stop(now + duration);
        });
      } catch (err) {
        console.error('Custom sound error:', err);
      }
    }

    // Generate paste command
    function generatePasteCommand() {
      if (!currentSoundId) {
        alert('Please load a sound first by clicking "Load" on any sound below');
        return;
      }

      const freq = document.getElementById('editFreq').value;
      const wave = document.getElementById('editWave').value;
      const duration = document.getElementById('editDuration').value;
      const volume = document.getElementById('editVolume').value;
      const attack = document.getElementById('editAttack').value;
      const decay = document.getElementById('editDecay').value;

      const freq2 = document.getElementById('editFreq2').value;
      const freq3 = document.getElementById('editFreq3').value;
      const delay2 = document.getElementById('editDelay2').value;
      const delay3 = document.getElementById('editDelay3').value;

      let params = `freq: ${freq}, wave: '${wave}', duration: ${duration}, volume: ${volume}, attack: ${attack}, decay: ${decay}`;

      // Add multi-tone params if present
      if (freq2) {
        params += `, freq2: ${freq2}, delay2: ${delay2}`;
      }
      if (freq3) {
        params += `, freq3: ${freq3}, delay3: ${delay3}`;
      }

      const command = `UPDATE: ${currentSoundName}
PARAMS: {${params}}`;

      const pasteEl = document.getElementById('pasteCommand');
      pasteEl.textContent = command;
      pasteEl.style.display = 'block';
      pasteEl.classList.remove('copied');
    }

    // Copy paste command to clipboard
    function copyPasteCommand() {
      const pasteEl = document.getElementById('pasteCommand');
      const command = pasteEl.textContent;

      navigator.clipboard.writeText(command).then(() => {
        pasteEl.classList.add('copied');
        setTimeout(() => {
          pasteEl.classList.remove('copied');
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy:', err);
        alert('Failed to copy to clipboard');
      });
    }

    // Play all sounds in sequence
    async function playAllSequence() {
      const sounds = [
        { name: 'Command Sent', fn: playCommandSent, delay: 300 },
        { name: 'App Command', fn: playAppCommand, delay: 300 },
        { name: 'Low Confidence', fn: playLowConfidence, delay: 400 },
        { name: 'Blocked Command', fn: playBlockedCommand, delay: 400 },
        { name: 'Mute', fn: playMuteTone, delay: 300 },
        { name: 'Unmute', fn: playUnmuteTone, delay: 400 },
        { name: 'System Beep', fn: playSystemBeep, delay: 300 }
      ];

      for (const sound of sounds) {
        console.log(`Playing: ${sound.name}`);
        sound.fn();
        await new Promise(resolve => setTimeout(resolve, sound.delay));
      }
    }
  </script>
</body>
</html>
